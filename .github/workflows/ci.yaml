name: ci

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    build:
        name: build
        runs-on: ubuntu-latest
        container: nvcr.io/nvidia/tensorrt:25.06-py3

        steps:
            - name: Checkout
              uses: actions/checkout@v4
              with:
                  submodules: "true"

            - name: Make
              run: make
              env:
                  CPLUS_INCLUDE_PATH: "/usr/include/aarch64-linux-gnu:/usr/local/cuda/targets/aarch64-linux-gnu/include"

            - name: Upload
              uses: actions/upload-artifact@v4
              with:
                  name: libnvinfer_lean_c
                  path: libnvinfer_lean_c.so
                  retention-days: 365
                  if-no-files-found: error
